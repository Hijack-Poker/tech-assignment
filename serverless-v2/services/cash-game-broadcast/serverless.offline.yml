service: cash-game-broadcast

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  stage: local
  region: us-east-1
  environment:
    STAGE: local
    MYSQL_HOST: ${env:MYSQL_HOST, 'localhost'}
    MYSQL_PORT: ${env:MYSQL_PORT, '3306'}
    MYSQL_USER: ${env:MYSQL_USER, 'hijack'}
    MYSQL_PASSWORD: ${env:MYSQL_PASSWORD, 'hijack_dev'}
    MYSQL_DATABASE: ${env:MYSQL_DATABASE, 'hijack_poker'}
    REDIS_HOST: ${env:REDIS_HOST, 'localhost'}
    REDIS_PORT: ${env:REDIS_PORT, '6379'}
    DYNAMODB_ENDPOINT: ${env:DYNAMODB_ENDPOINT, 'http://localhost:8000'}
    CONNECTIONS_TABLE: ${env:CONNECTIONS_TABLE, 'connections'}
    EVENTBRIDGE_ENDPOINT: ${env:EVENTBRIDGE_ENDPOINT, 'http://localhost:4010'}
    EVENT_BUS_NAME: ${env:EVENT_BUS_NAME, 'poker-events'}
    AWS_ACCESS_KEY_ID: ${env:AWS_ACCESS_KEY_ID, 'local'}
    AWS_SECRET_ACCESS_KEY: ${env:AWS_SECRET_ACCESS_KEY, 'local'}

functions:
  health:
    handler: handler.health
    events:
      - httpApi:
          path: /health
          method: GET

  broadcastTableState:
    handler: handler.main
    events:
      - httpApi:
          path: /broadcast
          method: POST

plugins:
  - serverless-offline

custom:
  serverless-offline:
    httpPort: 3032
    lambdaPort: 3033
